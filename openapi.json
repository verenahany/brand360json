{"openapi":"3.1.0","info":{"title":"FastAPI","version":"0.1.0"},"paths":{"/api/auth/login":{"post":{"tags":["auth"],"summary":"Login","description":"Login user via Simple LDAP and return JWT tokens","operationId":"login_api_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserLogin"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/token":{"post":{"tags":["auth"],"summary":"Login For Access Token","description":"OAuth2 compatible token login","operationId":"login_for_access_token_api_auth_token_post","requestBody":{"content":{"application/x-www-form-urlencoded":{"schema":{"$ref":"#/components/schemas/Body_login_for_access_token_api_auth_token_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/refresh":{"post":{"tags":["auth"],"summary":"Refresh Access Token","description":"Use refresh token to get a new access token","operationId":"refresh_access_token_api_auth_refresh_post","parameters":[{"name":"refresh_token","in":"query","required":true,"schema":{"type":"string","title":"Refresh Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/me":{"get":{"tags":["auth"],"summary":"Read Users Me","description":"Get current user information from LDAP","operationId":"read_users_me_api_auth_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/api/auth/logout":{"post":{"tags":["auth"],"summary":"Logout","description":"Logout user by clearing cookies","operationId":"logout_api_auth_logout_post","parameters":[{"name":"access_token","in":"cookie","required":false,"schema":{"type":"string","title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/test-ldap":{"get":{"tags":["auth"],"summary":"Test Ldap Connection","description":"Test LDAP connection (for debugging)","operationId":"test_ldap_connection_api_auth_test_ldap_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/health":{"get":{"tags":["auth"],"summary":"Health Check","description":"Health check endpoint","operationId":"health_check_api_auth_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/debug-import":{"get":{"tags":["auth"],"summary":"Debug Import","description":"Debug endpoint to check import status","operationId":"debug_import_api_auth_debug_import_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/chat":{"post":{"summary":"Chat","description":"Main endpoint for receiving queries with chat history support.\nThis endpoint handles:\n  - Session retrieval and message storage.\n  - Determining which bot (chat, web search, or SQL generator) to use.\n  - Streaming responses back to the client.","operationId":"chat_api_chat_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserQuery"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}/archive":{"put":{"summary":"Archive Session","description":"Archive or unarchive a chat session","operationId":"archive_session_api_sessions__session_id__archive_put","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Data"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/recover-messages":{"get":{"summary":"Recover Orphaned Messages","description":"Recover messages without a session by creating sessions for them","operationId":"recover_orphaned_messages_api_recover_messages_get","parameters":[{"name":"default_user_id","in":"query","required":false,"schema":{"type":"string","default":"user-1","title":"Default User Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}/limited-context":{"post":{"summary":"Set Limited Session Context","description":"Update the conversation history for a specific session with a\nlimited subset of messages to refresh stale context.","operationId":"set_limited_session_context_api_sessions__session_id__limited_context_post","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Data"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/diagnostic/orphaned_messages":{"get":{"summary":"Find Orphaned Messages","description":"Find messages that reference sessions that don't exist.\nUseful for diagnosing foreign key issues.","operationId":"find_orphaned_messages_api_diagnostic_orphaned_messages_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/diagnostic/create_session/{session_id}":{"post":{"summary":"Create Missing Session","description":"Create a session with the specified ID if it doesn't exist.\nUseful for recovering from foreign key constraint errors.","operationId":"create_missing_session_api_diagnostic_create_session__session_id__post","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}},{"name":"user_id","in":"query","required":false,"schema":{"type":"string","default":"1","title":"User Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/diagnostic/sessions/{session_id}":{"get":{"summary":"Check Session","description":"Diagnostic endpoint to check if a session exists and display its details.\nAlso shows any messages associated with it.","operationId":"check_session_api_diagnostic_sessions__session_id__get","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}":{"delete":{"summary":"Delete Session","description":"Soft delete a chat session by marking it inactive","operationId":"delete_session_api_sessions__session_id__delete","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"put":{"summary":"Update Session","description":"Update a chat session title","operationId":"update_session_api_sessions__session_id__put","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Body_update_session_api_sessions__session_id__put"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}/reset":{"post":{"summary":"Reset Session Conversation","description":"Instead of just resetting the conversation history,\nthis endpoint now loads previous messages from the database\nand updates the LLM's conversation history accordingly.","operationId":"reset_session_conversation_api_sessions__session_id__reset_post","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}/history":{"get":{"summary":"Get Session History","description":"Get the current conversation history for a session","operationId":"get_session_history_api_sessions__session_id__history_get","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}/messages":{"get":{"summary":"Get Session Messages","description":"Get messages for a specific chat session","operationId":"get_session_messages_api_sessions__session_id__messages_get","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":1,"default":100,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/ChatMessage"},"title":"Response Get Session Messages Api Sessions  Session Id  Messages Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions/{session_id}/messages/debug":{"get":{"summary":"Debug Session Messages","description":"Debug endpoint to see raw message data","operationId":"debug_session_messages_api_sessions__session_id__messages_debug_get","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sessions":{"get":{"summary":"Get Sessions","description":"Get chat sessions for the authenticated user","operationId":"get_sessions_api_sessions_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"default":20,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/ChatSession"},"title":"Response Get Sessions Api Sessions Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"summary":"Create Session","description":"Create a new chat session for the authenticated user","operationId":"create_session_api_sessions_post","security":[{"OAuth2PasswordBearer":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatSessionCreate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatSession"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/protected-data":{"get":{"summary":"Get Protected Data","description":"Example of a protected endpoint that requires authentication","operationId":"get_protected_data_api_protected_data_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"OAuth2PasswordBearer":[]}]}}},"components":{"schemas":{"Body_login_for_access_token_api_auth_token_post":{"properties":{"grant_type":{"anyOf":[{"type":"string","pattern":"^password$"},{"type":"null"}],"title":"Grant Type"},"username":{"type":"string","title":"Username"},"password":{"type":"string","format":"password","title":"Password"},"scope":{"type":"string","title":"Scope","default":""},"client_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Client Id"},"client_secret":{"anyOf":[{"type":"string"},{"type":"null"}],"format":"password","title":"Client Secret"}},"type":"object","required":["username","password"],"title":"Body_login_for_access_token_api_auth_token_post"},"Body_update_session_api_sessions__session_id__put":{"properties":{"title":{"type":"string","title":"Title"}},"type":"object","required":["title"],"title":"Body_update_session_api_sessions__session_id__put"},"ChatMessage":{"properties":{"message_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Message Id"},"session_id":{"type":"string","title":"Session Id"},"sender":{"type":"string","title":"Sender"},"content":{"type":"string","title":"Content"},"timestamp":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Timestamp"},"sql_results":{"anyOf":[{"items":{},"type":"array"},{"type":"null"}],"title":"Sql Results"},"web_results":{"anyOf":[{"items":{},"type":"array"},{"type":"null"}],"title":"Web Results"}},"type":"object","required":["session_id","sender","content"],"title":"ChatMessage"},"ChatSession":{"properties":{"session_id":{"type":"string","title":"Session Id"},"user_id":{"type":"string","title":"User Id"},"title":{"type":"string","title":"Title"},"created_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Created At"},"updated_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Updated At"},"is_active":{"type":"boolean","title":"Is Active","default":true},"metadata":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Metadata"}},"type":"object","required":["session_id","user_id","title"],"title":"ChatSession"},"ChatSessionCreate":{"properties":{"user_id":{"type":"string","title":"User Id"},"title":{"type":"string","title":"Title","default":"New Conversation"},"metadata":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Metadata"}},"type":"object","required":["user_id"],"title":"ChatSessionCreate"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"Token":{"properties":{"access_token":{"type":"string","title":"Access Token"},"refresh_token":{"type":"string","title":"Refresh Token"},"token_type":{"type":"string","title":"Token Type"}},"type":"object","required":["access_token","refresh_token","token_type"],"title":"Token"},"UserLogin":{"properties":{"email":{"type":"string","title":"Email"},"password":{"type":"string","title":"Password"},"remember_me":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Remember Me","default":false}},"type":"object","required":["email","password"],"title":"UserLogin"},"UserQuery":{"properties":{"query":{"type":"string","title":"Query"}},"type":"object","required":["query"],"title":"UserQuery"},"UserResponse":{"properties":{"id":{"type":"string","title":"Id"},"name":{"type":"string","title":"Name"},"email":{"type":"string","title":"Email"},"username":{"type":"string","title":"Username"},"first_name":{"type":"string","title":"First Name"},"last_name":{"type":"string","title":"Last Name"},"department":{"type":"string","title":"Department"},"title":{"type":"string","title":"Title"},"user_image":{"type":"string","title":"User Image"}},"type":"object","required":["id","name","email","username","first_name","last_name","department","title","user_image"],"title":"UserResponse"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"OAuth2PasswordBearer":{"type":"oauth2","flows":{"password":{"scopes":{},"tokenUrl":"/api/auth/token"}}}}}}